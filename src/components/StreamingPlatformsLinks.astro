---
import { getStreamingPlatforms } from "../utils/strapi";
import svgLoader from "../utils/svgLoader.js";
import { getCollection } from "astro:content";

// Compatible con desarrollo y Deno
const getEnv = (key: string, defaultValue: string = ""): string => {
  // @ts-expect-error - Deno is available in Deno runtime
  if (typeof Deno !== "undefined") {
    // @ts-expect-error - Deno.env is available in Deno runtime
    return Deno.env.get(key) || defaultValue;
  }
  return (import.meta.env as Record<string, string>)[key] || defaultValue;
};

const BASE_URL = getEnv("PUBLIC_STRAPI_API_URL", "http://localhost:1337");

// Obtener datos desde Strapi
const strapiData = await getStreamingPlatforms();
const streamingPlatforms =
  strapiData?.data || (await getCollection("streamingPlatforms"));

export const prerender = false;
---

<section class="mt-8">
  <ul>
    {
      streamingPlatforms.map((platform: any) => {
        // Acceder a los atributos de Strapi
        const title =
          platform.title || platform.data.title || "Unknown Platform";
        const url = platform.url || platform.data.url || "#";
        const icon = platform?.icon?.url || platform.data.icon || null;

        const svgContent = icon
          ? svgLoader.getSvgContentFromStrapi(BASE_URL + icon) ||
            svgLoader.getSvgContent(icon)
          : null;

        return (
          <li>
            <a
              href={url}
              target="_blank"
              class="w-full justify-center font-semibold not-hover:text-white hover:text-indigo-600 hover:scale-105 hover:shadow-lg shadow-sm relative flex items-center px-4 py-3 mb-3 bg-neutral-900/10 border border-white/10 hover:border-transparent rounded-2xl hover:bg-neutral-950/50 cursor-pointer transition"
            >
              {svgContent ? (
                <div set:html={svgContent} class="streaming-platform-icon" />
              ) : (
                <span class="absolute inline-block left-4 text-sm">ðŸ“Œ</span>
              )}
              <span class="text-lg font-medium">{title}</span>
            </a>
          </li>
        );
      })
    }
  </ul>
</section>
